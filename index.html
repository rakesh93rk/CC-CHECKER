<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Levi Interior — Staff Login</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

body{
  margin:0;height:100vh;display:flex;justify-content:center;align-items:center;
  background:#eef2ff;font-family:Inter,Arial
}
.card{
  background:#fff;width:360px;padding:28px;border-radius:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.12);text-align:center
}
.logo{width:80px;margin:auto}
h1{margin:10px 0 4px}
.tag{color:#64748b;margin-bottom:16px}
input{
  width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;
  margin-bottom:10px;font-size:15px;text-align:center
}
button{
  width:100%;padding:12px;border:none;border-radius:10px;
  background:linear-gradient(90deg,#2563eb,#06b6d4);
  color:#fff;font-weight:700;cursor:pointer
}
button:disabled{opacity:.6;cursor:not-allowed}
#otpArea{display:none;margin-top:10px}
.resend{margin-top:8px;font-size:13px;color:#64748b}
.resend span{color:#2563eb;font-weight:600;cursor:pointer}
footer{margin-top:12px;color:#64748b;font-size:13px}

/* Toast */
.toast{
  position:fixed;top:20px;right:20px;padding:14px 18px;border-radius:12px;
  color:#fff;font-size:14px;opacity:0;transform:translateY(-20px);
  animation:show .4s forwards,hide .4s forwards 2.6s;z-index:9999
}
.toast.success{background:#16a34a}
.toast.error{background:#dc2626}
@keyframes show{to{opacity:1;transform:translateY(0)}}
@keyframes hide{to{opacity:0;transform:translateY(-20px)}}
</style>
</head>

<body>

<div class="card">
  <img src="https://i.imgur.com/284Ol04.jpeg" class="logo">
  <h1>Levi Interior</h1>
  <div class="tag">Staff Portal — Login</div>

  <input id="mobile" placeholder="Enter Mobile Number">
  <button id="btnSendOtp">Send OTP</button>

  <div id="otpArea">
    <input id="otpInput" placeholder="Enter OTP" maxlength="6">
    <button id="btnVerifyOtp">Verify OTP</button>
    <div class="resend" id="resendText">
      Resend OTP in <b id="timer">30</b>s
    </div>
  </div>

  <footer>© 2026 Levi Interior</footer>
</div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<script>
/* ---------- Toast ---------- */
function toast(msg,type="success"){
  const t=document.createElement("div");
  t.className="toast "+type;
  t.innerText=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),3000);
}

/* ---------- DEMO STAFF DATA ----------
localStorage.setItem(
 "usersData",
 JSON.stringify([{name:"Admin",mobile:"9398039725"}])
);
------------------------------------ */
const users = JSON.parse(localStorage.getItem("usersData")) || [];

/* ---------- Firebase Init ---------- */
firebase.initializeApp({
  apiKey: "AIzaSyBWeGPZxRo_86VJf0s6hBHITfyBu07hphk",
  authDomain: "levi-interior-otp.firebaseapp.com",
  projectId: "levi-interior-otp",
  storageBucket: "levi-interior-otp.firebasestorage.app",
  messagingSenderId: "341247799538",
  appId: "1:341247799538:web:f8b1ac4146429a4dca606b"
});
const auth = firebase.auth();

/* ---------- Elements ---------- */
const btnSendOtp = document.getElementById("btnSendOtp");
const btnVerifyOtp = document.getElementById("btnVerifyOtp");
const otpArea = document.getElementById("otpArea");
const otpInput = document.getElementById("otpInput");
const timerEl = document.getElementById("timer");
const resendText = document.getElementById("resendText");

/* ---------- reCAPTCHA (ONCE) ---------- */
let recaptchaReady=false;
function initRecaptcha(){
  if(recaptchaReady) return;
  window.recaptchaVerifier=new firebase.auth.RecaptchaVerifier(
    btnSendOtp,{size:"invisible"}
  );
  recaptchaReady=true;
}

/* ---------- RESEND TIMER ---------- */
let countdown;
function startTimer(){
  let t=30;
  btnSendOtp.disabled=true;
  resendText.innerHTML=`Resend OTP in <b id="timer">${t}</b>s`;
  countdown=setInterval(()=>{
    t--;
    document.getElementById("timer").innerText=t;
    if(t<=0){
      clearInterval(countdown);
      resendText.innerHTML=`<span onclick="resendOtp()">Resend OTP</span>`;
      btnSendOtp.disabled=false;
    }
  },1000);
}

/* ---------- SEND OTP ---------- */
function sendOtp(){
  const mobile=document.getElementById("mobile").value.trim();

  if(!/^[6-9]\d{9}$/.test(mobile)){
    toast("Invalid mobile number","error");return;
  }
  if(!users.find(u=>u.mobile===mobile)){
    toast("You are not authorized","error");return;
  }

  initRecaptcha();

  auth.signInWithPhoneNumber("+91"+mobile,window.recaptchaVerifier)
    .then(res=>{
      window.confirmationResult=res;
      otpArea.style.display="block";
      toast("OTP sent successfully");
      startTimer();
      otpInput.focus();
    })
    .catch(err=>{
      console.log(err.code,err.message);
      toast("OTP send failed","error");
    });
}
btnSendOtp.onclick=sendOtp;

/* ---------- RESEND OTP ---------- */
function resendOtp(){
  sendOtp();
}

/* ---------- AUTO VERIFY OTP ---------- */
otpInput.addEventListener("input",()=>{
  if(otpInput.value.length===6){
    verifyOtp();
  }
});

/* ---------- VERIFY OTP ---------- */
function verifyOtp(){
  const otp=otpInput.value.trim();
  if(otp.length!==6) return;

  confirmationResult.confirm(otp)
    .then(()=>{
      toast("Login successful");
      setTimeout(()=>location.href="main.html",3000);
    })
    .catch(()=>toast("Invalid OTP","error"));
}
btnVerifyOtp.onclick=verifyOtp;
</script>

</body>
</html>
